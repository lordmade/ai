<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MusicVerse - Song Submission Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js"></script>
</head>
<body class="bg-gray-100">
  <div id="app" class="container mx-auto p-4">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold">MusicVerse</h1>
      <div>
        <button id="signInBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 hidden">Sign In with Google</button>
        <button id="signOutBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 hidden">Sign Out</button>
        <span id="userInfo" class="text-gray-700"></span>
      </div>
    </div>

    <!-- Song Upload Form -->
    <div id="uploadSection" class="mb-8 p-4 bg-white rounded-lg shadow hidden">
      <h2 class="text-xl font-semibold mb-4">Upload Your Song</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium">Song Title</label>
          <input id="songTitle" type="text" class="mt-1 p-2 w-full border rounded" placeholder="Enter song title">
        </div>
        <div>
          <label class="block text-sm font-medium">Artist</label>
          <input id="artist" type="text" class="mt-1 p-2 w-full border rounded" placeholder="Enter artist name">
        </div>
        <div>
          <label class="block text-sm font-medium">Song File (MP3)</label>
          <input id="songFile" type="file" accept="audio/mp3" class="mt-1 p-2 w-full border rounded">
        </div>
        <button id="uploadBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Upload Song</button>
      </div>
    </div>

    <!-- Song List -->
    <div>
      <h2 class="text-xl font-semibold mb-4">Available Songs</h2>
      <div id="songList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <!-- Audio Player -->
    <div id="audioPlayer" class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 hidden">
      <h3 id="currentSongInfo" class="text-lg font-medium"></h3>
      <audio id="audio" controls class="w-full mt-2"></audio>
    </div>
  </div>

  <script>
    // Firebase Configuration (Replace with your Firebase project config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // DOM Elements
    const signInBtn = document.getElementById('signInBtn');
    const signOutBtn = document.getElementById('signOutBtn');
    const userInfo = document.getElementById('userInfo');
    const uploadSection = document.getElementById('uploadSection');
    const songTitle = document.getElementById('songTitle');
    const artist = document.getElementById('artist');
    const songFile = document.getElementById('songFile');
    const uploadBtn = document.getElementById('uploadBtn');
    const songList = document.getElementById('songList');
    const audioPlayer = document.getElementById('audioPlayer');
    const audio = document.getElementById('audio');
    const currentSongInfo = document.getElementById('currentSongInfo');

    // Authentication State
    auth.onAuthStateChanged((user) => {
      if (user) {
        userInfo.textContent = `Signed in as ${user.displayName}`;
        signInBtn.classList.add('hidden');
        signOutBtn.classList.remove('hidden');
        uploadSection.classList.remove('hidden');
      } else {
        userInfo.textContent = '';
        signInBtn.classList.remove('hidden');
        signOutBtn.classList.add('hidden');
        uploadSection.classList.add('hidden');
      }
    });

    // Sign in with Google
    signInBtn.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch((error) => {
        console.error('Sign-in error:', error);
        alert('Failed to sign in.');
      });
    });

    // Sign out
    signOutBtn.addEventListener('click', () => {
      auth.signOut().catch((error) => {
        console.error('Sign-out error:', error);
        alert('Failed to sign out.');
      });
    });

    // Fetch and display songs
    function loadSongs() {
      db.collection('songs').orderBy('timestamp', 'desc').get().then((snapshot) => {
        songList.innerHTML = '';
        snapshot.forEach((doc) => {
          const song = doc.data();
          const songCard = document.createElement('div');
          songCard.className = 'p-4 bg-white rounded-lg shadow';
          songCard.innerHTML = `
            <h3 class="text-lg font-medium">${song.title}</h3>
            <p class="text-gray-600">${song.artist}</p>
            <button class="play-btn mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-url="${song.url}" data-title="${song.title}" data-artist="${song.artist}">Play</button>
          `;
          songList.appendChild(songCard);
        });

        // Add play button listeners
        document.querySelectorAll('.play-btn').forEach((btn) => {
          btn.addEventListener('click', () => {
            const url = btn.getAttribute('data-url');
            const title = btn.getAttribute('data-title');
            const artist = btn.getAttribute('data-artist');
            audio.src = url;
            currentSongInfo.textContent = `${title} - ${artist}`;
            audioPlayer.classList.remove('hidden');
            audio.play();
          });
        });
      }).catch((error) => {
        console.error('Error fetching songs:', error);
      });
    }

    // Load songs on page load
    loadSongs();

    // Upload song
    uploadBtn.addEventListener('click', async () => {
      if (!songTitle.value || !artist.value || !songFile.files[0]) {
        alert('Please fill in all fields and select an MP3 file.');
        return;
      }

      if (songFile.files[0].type !== 'audio/mpeg') {
        alert('Please select an MP3 file.');
        return;
      }

      try {
        // Upload file to Firebase Storage
        const storageRef = storage.ref(`songs/${Date.now()}-${songFile.files[0].name}`);
        const snapshot = await storageRef.put(songFile.files[0]);
        const url = await snapshot.ref.getDownloadURL();

        // Save metadata to Firestore
        await db.collection('songs').add({
          title: songTitle.value,
          artist: artist.value,
          url: url,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Clear form
        songTitle.value = '';
        artist.value = '';
        songFile.value = '';
        alert('Song uploaded successfully!');
        loadSongs(); // Refresh song list
      } catch (error) {
        console.error('Upload error:', error);
        alert('Failed to upload song.');
      }
    });
  </script>
</body>
</html>
